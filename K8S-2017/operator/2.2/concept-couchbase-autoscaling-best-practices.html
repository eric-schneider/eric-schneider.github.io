<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Couchbase Cluster Auto-scaling Best Practices | Couchbase Docs</title>
<link rel="canonical" href="https://eric-schneider.github.io/K8S-2017/operator/2.2/concept-couchbase-autoscaling-best-practices.html">
<link rel="stylesheet" href="../../_/css/site.css">
<script src="../../_/js/vendor/jquery.js"></script>
<link rel="schema.dcterms" href="https://purl.org/dc/terms/">
<meta name="dcterms.subject" content="operator">
<meta name="dcterms.identifier" content="2.2">
<meta name="generator" content="Antora 3.0.0-alpha.3">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
</head>
<body class="article">
<header class="header fixed-top">
  <div class="header-top-row">
      <div class="container">
          <nav class="navbar navbar-expand-md flex-nowrap justify-content-between navbar-new-top">
              <ul class="navbar-brand-list">
                <li class="brand-logo">
                  <a class="navbar-brand" href="https://www.couchbase.com">
                    <img src="../../_/img/couchbase-logo.svg" alt="Couchbase" />
                  </a>
                </li>
                <li>
                  <a class="navbar-brand cb-documentation" href="https://docs.couchbase.com">
                    <img src="../../_/img/cb-documentation.svg" alt="Couchbase Documentation" class="cb-docs" />
                    <img src="../../_/img/cb-docs-hover.svg" alt="Couchbase Documentation" class="hide cb-hover-docs" />
                  </a>
                </li>
              </ul>
              <button class="navbar-burger" data-target="topbar-menu">
                <span></span>
                <span></span>
                <span></span>
              </button>

          </nav>
      </div>
  </div>
  <div class="header-bottom-row" id="topbar-menu">
    <div class="container">
        <nav  class="navbar navbar-new-bottom">

              <div class="navbar-collapse collapse" id="navbar2">
                <ul class="navbar-nav w-100 justify-content-start">
                  <li class="nav-item">
                    <a href="https://eric-schneider.github.io/K8S-2017/home/index.html" class="nav-link">
                      <i class="fas fa-home"></i>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/server.html">
                      Server
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/mobile.html">
                      Mobile
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/cloud.html">
                      Cloud
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="../../home/sdk.html">
                      SDKs
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">
                      Tutorials
                      <span class="arrow">
                        <i class="fas fa-arrow-right"></i>
                      </span>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="primary-action">
                <a href="https://cloud.couchbase.com/sign-up" class="free-trial-link" onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Free Trial'});" >
                  <i class="fas fa-cloud"></i>
                  Free Trial
                </a>
                <a class="btn btn-primary try-btn"  onclick="(window.dataLayer=window.dataLayer||[]).push({'event':'customEvent', 'category':'CTA', 'action':'Button Click',  'label':'Download'});" href="https://www.couchbase.com/downloads">
                  Downloads
                </a>
              </div>

        </nav>
    </div>
   </div>
</header>
<div class="body container">
<nav class="nav">
<div class="left-sidebar-menu">
<div class="version-control-box">
<div class="component-frame">
<div class="frame-icon">
<img src="../../_/img/server-icon.png" alt="">
</div>
<div class="frame-body">
<h4 class="title"><span class="">Autonomous Operator</span></h4>
<a class="frame-link component" href="overview.html"> <span class="version">2.2</span></a>
</div>
</div>
</div>
<div class="nav-menu">
<ul class="nav-list">
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Introduction</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="overview.html">Introduction</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="whats-new.html">What&#8217;s New?</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="best-practices.html">Guidelines and Best Practices</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="prerequisite-and-setup.html">Prerequisites and System Requirements</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="prerequisite-cloud.html">Public Cloud Prerequisites</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="install-kubernetes.html">Install the Operator on Kubernetes</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="install-openshift.html">Install the Operator on OpenShift</a>
</span>
</li>
</ul>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Learn</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Kubernetes Concepts</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-kubernetes-networking.html">Kubernetes Networking</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-persistent-volumes.html">Persistent Volumes</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-kubernetes-upgrade.html">Kubernetes Automated Upgrade</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Operator Concepts</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-operator.html">Operator Architecture</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-operator-logging.html">Operator Logging</a>
</span>
</li>
</ul>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Couchbase Cluster Concepts</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-label-selection.html">Couchbase Resource Label Selection</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-rbac.html">Couchbase Resource RBAC</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-user-rbac.html">Couchbase User RBAC</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-memory-allocation.html">Couchbase Memory Allocation</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-mds.html">Couchbase Multi-Dimensional Scaling</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-scheduling.html">Couchbase Scheduling and Isolation</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-sizing.html">Couchbase Sizing</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-vertical-scaling.html">Couchbase Cluster Vertical Scaling</a>
</span>
</li>
<li class="nav-item is-current-path is-active is-active-depth-2  " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<a class="nav-link" href="concept-couchbase-autoscaling.html">Couchbase Cluster Autoscaling</a>
</span>
<ul class="nav-list">
<li class="nav-item is-current-page is-active is-active-depth-2  " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="concept-couchbase-autoscaling-best-practices.html">Auto-scaling Best Practices</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-couchbase-networking.html">Couchbase Networking</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-tls.html">Couchbase TLS</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-credential-rotation.html">Couchbase Credential Rotation</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-server-groups.html">Couchbase Server Groups</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-upgrade.html">Couchbase Upgrades</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-hibernation.html">Couchbase Cluster Hibernation</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-couchbase-logging.html">Couchbase Logging</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="concept-backup.html">Couchbase Backup and Restore</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Manage</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Operator</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="howto-operator-upgrade.html">Upgrade the Operator</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="howto-manage-operator-logging.html">Manage Operator Logging</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="howto-roll-your-own.html">Create Your Own Operator Images</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Couchbase Cluster</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Lifecycle</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-couchbase-create.html">Create a Couchbase Deployment</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-couchbase-update.html">Modify a Couchbase Deployment</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-couchbase-upgrade.html">Upgrade a Couchbase Deployment</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-couchbase-delete.html">Delete a Couchbase Deployment</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-couchbase-scale.html">Scale a Couchbase Deployment</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Configure</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-persistent-volumes.html">Configure Persistent Volumes</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-persistent-volume-resize.html">Resize Persistent Volumes</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-backup.html">Configure Backup &amp; Restore</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-mds.html">Configure Multi-Dimensional Scaling</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-xdcr.html">Configure XDCR</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-public-networking.html">Configure Public Networking</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-nodeport-networking.html">Configure Node Port Networking</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-server-groups.html">Configure Server Groups</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-admin-password-rotation.html">Rotate the Administrator Password</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-tls.html">Configure TLS</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-tls-client-certificates.html">Configure Client Certificate Authentication</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-tls-rotation.html">Rotate TLS Certificates</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-prometheus.html">Configure Prometheus Metrics Collection</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-manage-couchbase-logging.html">Manage Couchbase Logging</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-couchbase-log-forwarding.html">Configure Log Forwarding</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-non-root-install.html">Configure Non-Root Installs</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<span class="in-toggle" data-depth="2"></span>
<span class="nav-text ">Connect</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-ui.html">Access the Couchbase User Interface</a>
</span>
</li>
<li class="nav-item " data-depth="3">

<span class="nav-line "  data-depth="3">
<a class="nav-link" href="howto-client-sdks.html">Configure Client SDKs</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Kubernetes</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="howto-storage-class.html">Create a Lazy Bound Storage Class</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Helm</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="helm-setup-guide.html">Helm Deployment</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="helm-managing-guide.html">Helm Management</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Reference</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Resource Types</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="reference-resources.html">Resource Documentation</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbaseautoscaler.html">CouchbaseAutoscaler Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbasebackuprestore.html">CouchbaseBackupRestore Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbasebackup.html">CouchbaseBackup Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbasebucket.html">CouchbaseBucket Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbasecluster.html">CouchbaseCluster Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbaseephemeralbucket.html">CouchbaseEphemeralBucket Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbasegroup.html">CouchbaseGroup Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbasememcachedbucket.html">CouchbaseMemcachedBucket Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbasereplication.html">CouchbaseReplication Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbaserolebinding.html">CouchbaseRoleBinding Resource</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="resource/couchbaseuser.html">CouchbaseUser Resource</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Operator</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="reference-admission-cli.html">Dynamic Admission Controller Deployment Settings</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="reference-admission-rbac.html">Dynamic Admission Controller RBAC Settings</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="reference-operator-configuration.html">Operator Deployment Settings</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="reference-operator-rbac.html">Operator RBAC Settings</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="reference-operator-logging.html">Operator Logging</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Couchbase Cluster</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="reference-couchbasecluster-events.html"><code>CouchbaseCluster</code> Events</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="reference-couchbasecluster-services.html"><code>CouchbaseCluster</code> Services</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Helm</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="helm-couchbase-config.html">Couchbase Helm Chart Specification</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Tools</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="tools/cbopcfg.html">cbopcfg</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="tools/cbopinfo.html">cbopinfo</a>
</span>
</li>
</ul>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Tutorials</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">Sync Gateway</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="tutorial-sync-gateway.html">Connecting Sync-Gateway to a Couchbase Cluster</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="tutorial-sync-gateway-clients.html">Exposing Sync-Gateway to Couchbase Lite Clients</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="tutorial-sync-gateway-manage.html">Managing Sync Gateway Cluster </a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<span class="in-toggle" data-depth="1"></span>
<span class="nav-text ">TLS</span>
</span>
<ul class="nav-list">
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="tutorial-tls.html">Creating TLS Certificates</a>
</span>
</li>
<li class="nav-item " data-depth="2">

<span class="nav-line "  data-depth="2">
<a class="nav-link" href="tutorial-cert-manager.html">Using a Certificate Manager</a>
</span>
</li>
</ul>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-remote-dns.html">Inter-Kubernetes Networking with Forwarded DNS</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-public-addressability.html">Public Networking with External DNS</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-velero-backup.html">Backup with VMware Velero</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-prometheus.html">Quick Start with Prometheus Monitoring</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-rbac-auth.html">Authenticating with Couchbase and LDAP</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-autoscale.html">Autoscaling Couchbase Stateless Services</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-metering.html">Metering Couchbase Resources In OpenShift</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-metering-kubernetes.html">Metering Couchbase Resources In Kubernetes</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-couchbase-log-forwarding.html">Forwarding Couchbase Logs with Fluent Bit</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-aks.html">Installing AKS</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-eks.html">Installing EKS</a>
</span>
</li>
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="tutorial-gke.html">Installing GKE</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Release Notes</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="release-notes.html">Release Notes</a>
</span>
</li>
</ul>
</li>
<li class="nav-item " data-depth="0">

<span class="nav-line "  data-depth="0">
<span class="in-toggle" data-depth="0"></span>
<span class="nav-text ">Cloud-Native Database</span>
</span>
<ul class="nav-list">
<li class="nav-item  is-inactive " data-depth="1">

<span class="nav-line "  data-depth="1">
<a class="nav-link" href="#cloud-native-database::index.adoc">Go to Cloud-Native Database Documentation</a>
</span>
</li>
</ul>
</li>
</ul>
</div>
<a href="#" class="menu-expand-toggle"> <span>Navigation</span> <i class="fas fa-times-circle"></i> <i class="fas fa-chevron-circle-left"></i></a>
</div></nav>
<aside class="toc sidebar">
  <div class="sidebar-box">
    <div class="tools" role="navigation">
<ul>
<li class="tool edit"><a href="file:///Users/ericschneider/repos/couchbase-operator/docs/user/modules/ROOT/pages/concept-couchbase-autoscaling-best-practices.adoc" title="Edit Page" target="_blank" rel="noopener">Edit on GitHub</a></li>
</ul>
</div>
    <div class="toc-menu"></div>
    <div class="is-this-helpful-box">
      <h4> Is this page helpful?</h4>
      <div class="btn-row">
        <a href="#" class="like-btn helpful-btn" id="yesBtn" data-page-rating="like" >
                <i class="far fa-thumbs-up"></i>
            Yes

            </a>
        <a href="#" class="dislike-btn helpful-btn" id="noBtn"  data-page-rating="dislike"> <i class="far fa-thumbs-down"></i> No</a>
      </div>
      <div class="any-feedback">
        <a href="#" class="btn any-feedback-btn" id="myCustomTrigger">Leave Additional Feedback? </a>
      </div>
      <div class="dialog-box" id="dialogBox">
        <form>
            <div class="form-group " id="additionalFeedbackBox">
              <textarea class="input-control feed-back-msg" rows="8" placeholder="Any Additonal Feedback?"></textarea>

              <div class="action-btn-row ">
                <a href="#" class="skip-btn" id="skipBtnMsg">Skip</a>
                  <button class="submit-btn btn blue-btn disabled" > Submit  </button>
                  <a href="#" class="info-btn"><i class="fas fa-info-circle"></i></a>
              </div>


            </div>

        </form>

      </div>
    </div>
  </div>

</aside>

<div class="feedback-modal modal-popup">
  <div class="modal-popup-dialogue">
    <div class="popup-header">
      <a href="#" class="close-popup"><i class="fa fa-times"></i></a>
    </div>
    <div class="popup-content">
      <p>
        Please use the form below to provide your feedback. Because your feedback is valuable to us,
         the information you submit in this form is recorded in our issue tracking system (JIRA), which is publicly available.
        You can track the status of your feedback using the ticket number displayed in the dialog once you submit the form.
      </p>
    </div>
  </div>
</div>

<main class="article" data-ceiling="topbar">
<div class="article-header">
<nav class="crumbs" aria-label="breadcrumbs">
<ul>
<li class="crumb"><a href="overview.html">Autonomous Operator</a></li>
<li class="crumb">Learn</li>
<li class="crumb">Couchbase Cluster Concepts</li>
<li class="crumb"><a href="concept-couchbase-autoscaling.html">Couchbase Cluster Autoscaling</a></li>
<li class="crumb"><a href="concept-couchbase-autoscaling-best-practices.html">Auto-scaling Best Practices</a></li>
</ul>
</nav>
</div>
<article class="doc">
<div class="page-heading-title">
<h1 class="page">Couchbase Cluster Auto-scaling Best Practices</h1>
</div>
<div class="contributor-list-box">
<span class="last-commit-date" id="commitdate">    </span>
<ul id="contributorList"></ul>
<span  id="otherContributor"> + </span>
</div><div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
Recommended best practices, derived from tested performance metrics, for configuring Couchbase cluster auto-scaling using the Couchbase Autonomous Operator.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-use-this-page"><a class="anchor" href="#how-to-use-this-page"></a>How to Use This Page</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This page provides guidance on how to configure the Autonomous Operator&#8217;s <a href="concept-couchbase-autoscaling.html" class="page">auto-scaling feature</a> to effectively scale Couchbase clusters.
Specifically, it discusses relevant metrics for scaling individual Couchbase Services, and provides recommended settings based on internal benchmark testing performed by Couchbase.</p>
</div>
<div class="paragraph">
<p>With the exception of <a href="#general-best-practices">General Best Practices</a>, the information on this page is organized into sections for each <em>Couchbase Service</em>, within which are subsections describing relevant <em>metrics</em> that can be used for auto-scaling that particular service.</p>
</div>
<div class="sect2">
<h3 id="metrics"><a class="anchor" href="#metrics"></a>Metrics</h3>
<div class="paragraph">
<p>The subsections for each metric include a general discussion of the metric in the context of scaling, as well as recommendations on how to effectively use that metric to auto-scale the relevant Couchbase Service.
These recommendations include <em>recommended settings</em> that are based on internal benchmark testing performed by Couchbase.</p>
</div>
<div class="paragraph">
<div class="title">How to Interpret Recommended Auto-scaling Settings</div>
<p>Recommended auto-scaling settings are presented in a tabular structure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Recommended Settings</strong>: This tab presents the recommended settings in a table.
Additional clarifying notes about the recommended settings, if any, are listed below the table.</p>
</li>
<li>
<p><strong>Example Configs</strong>: This tab provides YAML snippets that show the recommended settings as they are applied in the relevant resources (e.g. <code>CouchbaseCluster</code> and <code>HorizontalPodAutoscaler</code>).</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_recommended-settings"></a>Recommended Settings</p>
</li>
<li>
<p><a id="tabset1_example-configs"></a>Example Configs</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_recommended-settings">
<table id="table-autoscale-recommendations-example" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Threshold</th>
<th class="tableblock halign-left valign-top">HPA Stabilization Window</th>
<th class="tableblock halign-left valign-top">Couchbase Stabilization Period</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>metric.name</code> you will specify in the <code>HorizontalPodAutoscaler</code> resource so that it will monitor the metric for auto-scaling purposes.</p>
<p class="tableblock">Example: <code>cpu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The recommended <code>target</code> value for the metric that, when exceeded in either direction, will prompt the Horizontal Pod Autoscaler to initiate a scaling event.</p>
<p class="tableblock">Example: <code>70%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>stabilizationWindowSeconds</code> in the past that the Horizontal Pod Autoscaler will look into when considering desired states for the cluster.  since the last scaling event before another scaling event should occur.</p>
<p class="tableblock">Example: <code>scaleUp: 30s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>autoscaleStabilizationPeriod</code> you will specify in the <code>CouchbaseCluster</code> resource that defines the amount of time after Couchbase rebalance has begun to enable the HPA to resume reading stats.</p>
<p class="tableblock">Example: <code>0s</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tab-pane" aria-labelledby="tabset1_example-configs">
<div class="listingblock">
<div class="title">Example <code>CouchbaseCluster</code> Recommended Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  autoscaleStabilizationPeriod: 0s <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recommended Couchbase Stabilization Period</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>HorizontalPodAutoscaler</code> Recommended Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: HorizontalPodAutoscaler
apiVersion: autoscaling/v2beta2
metadata:
  name: data-hpa
spec:
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 30 <i class="conum" data-value="1"></i><b>(1)</b>
      policies:
      - type: Pods
        value: 1
        periodSeconds: 15
    scaleDown:
      stabilizationWindowSeconds: 300 <i class="conum" data-value="1"></i><b>(1)</b>
  metrics:
  - type: Pods
    pods:
      metric:
        name: cbbucketinfo_basic_quota_user_percent <i class="conum" data-value="2"></i><b>(2)</b>
      target:
        type: AverageValue
        averageValue: 70 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recommended HPA Stabilization Window</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Recommended Metric</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Recommended Threshold</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="general-best-practices"><a class="anchor" href="#general-best-practices"></a>General Best Practices</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">Best Practices for Configuring the <code>HorizontalPodAutoscaler</code> Resource</div>
<ul>
<li>
<p>Setting a value for <code>maxReplicas</code> is required because it provides important protection against runaway scaling events.
Due to the highly-configurable nature of cluster auto-scaling, setting a cap on the maximum number scaling nodes is the simplest, most valuable protection you can give yourself against a potentially costly misconfiguration.</p>
</li>
<li>
<p>Setting <code>minReplicas</code> is important for maintaining service availability.
If left undefined, Kubernetes uses the <a href="https://pkg.go.dev/k8s.io/api/autoscaling/v1#HorizontalPodAutoscalerSpec" target="_blank" rel="noopener">default value of <code>1</code> pod</a>, which may be fine for your non-production deployments.
However, when using auto-scaling in production, it is recommended that you set <code>minReplicas</code> to at least <code>2</code> or greater (<code>3</code> or greater for the Data Service).
This ensures a minimum level of protection against single-node failures.</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
You can technically set <code>minReplicas</code> to <code>0</code> by enabling the <code>HPAScaleToZero</code> <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/" target="_blank" rel="noopener">feature gate</a>.
You should never do this, as the Autonomous Operator prevents server class configurations from having sizes less than 1.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-service"><a class="anchor" href="#data-service"></a>Data Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="metric-bucket-memory-utilization"><a class="anchor" href="#metric-bucket-memory-utilization"></a>Metric: Bucket Memory Utilization</h3>
<div class="paragraph">
<p>Couchbase Server uses a fully integrated in-memory caching layer to provide high-speed access to bucket data.
Every bucket has a configurable memory quota that determines how much memory should be consistently maintained within the caching layer for each individual bucket.
Each bucket&#8217;s individual memory quota is subtracted from the overall memory quota assigned to the Data Service.</p>
</div>
<div class="paragraph">
<p>Data associated with <em>Couchbase</em> buckets is stored in memory and persisted on disk, whereas data associated with <em>Ephemeral</em> buckets is exclusively maintained in memory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a Couchbase bucket’s memory quota is exceeded, infrequently used data items are <a href="../../server/7.0/learn/buckets-memory-and-storage/memory.html#ejection" class="page">ejected</a> from memory, leaving only the persisted copies of those data items on disk.</p>
</li>
<li>
<p>If an Ephemeral bucket’s memory quota is exceeded, one of the following will occur depending on how the bucket is configured:</p>
<div class="ulist">
<ul>
<li>
<p>Resident data-items remain in memory, but requests to add new data are rejected until an administrator frees enough space to support continued data-ingestion</p>
</li>
<li>
<p>Resident data-items are ejected from memory to make way for new data
(and because the data-items in Ephemeral buckets are not persisted on disk, they cannot be reacquired after ejection)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your goal it to prevent document ejection and maintain each bucket&#8217;s data within RAM, then you must prevent each bucket&#8217;s memory utilization from ever reaching the high water mark.
In practice this means that before the high water mark is reached, you must either increase the bucket&#8217;s memory quota, or scale out the cluster with additional nodes running the Data Service (thus increasing the total amount of memory reserved for all buckets).</p>
</div>
<div class="paragraph">
<p>The first solution&#8201;&#8212;&#8201;increasing the bucket&#8217;s memory quota&#8201;&#8212;&#8201;requires manual intervention and may not be possible if there is no unreserved memory left on Data Service nodes.
This makes the second solution&#8201;&#8212;&#8201;scaling out the number of Data Service nodes&#8201;&#8212;&#8201;much more desirable, and an ideal use-case for cluster auto-scaling.</p>
</div>
<div class="sect3">
<h4 id="recommendations"><a class="anchor" href="#recommendations"></a>Recommendations</h4>
<div class="paragraph">
<p>The recommended metric for bucket memory utilization is <code>cbbucketinfo_basic_quota_user_percent</code>.
This metric is a Couchbase "custom metric" provided by the Couchbase Prometheus Exporter.
It represents the percentage of bucket memory utilization in relation to the bucket&#8217;s quota.</p>
</div>
<div class="paragraph">
<p>The following considerations should be taken into account when scaling on this metric:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The threshold percentage needs to be below the memory high water mark, otherwise data may be ejected from memory before the cluster scales up.</p>
</li>
<li>
<p>The threshold needs to be low enough that the cluster has enough time to rebalance before the high water mark is reached or the threshold cannot be reached.</p>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_recommended-settings"></a>Recommended Settings</p>
</li>
<li>
<p><a id="tabset2_example-configs"></a>Example Configs</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_recommended-settings">
<div class="paragraph">
<p>Based on internal benchmark testing, we believe the following settings provide a good starting point for scaling the Data Service based on <em>bucket memory utilization</em>:</p>
</div>
<table id="table-autoscale-data-recommendations-memory-utilization" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Threshold</th>
<th class="tableblock halign-left valign-top">HPA Stabilization Window</th>
<th class="tableblock halign-left valign-top">Couchbase Stabilization Period</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cbbucketinfo_basic_quota_user_percent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>70%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0s</code></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">General notes:</div>
<ul>
<li>
<p>Benchmark tests were based on buckets that had a 30% average write rate, 1k average doc sizes, and default compaction threshold.</p>
</li>
<li>
<p>You should consider using a lower threshold for buckets with a higher average write rate or larger average doc sizes.
This is because rebalance will take longer, thus increasing the risk of exceeding the high water mark.</p>
</li>
<li>
<p>As a cost saving measure, you can consider setting a higher threshold for buckets that experience lighter workloads.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Notes on Ephemeral buckets:</div>
<ul>
<li>
<p>Ephemeral buckets are more costly, but exhibit more predictable performance when it comes to scaling because no fragmentation occurs.
Couchbase buckets are more cost efficient, but they have less predictable scaling performance, thus making auto-scaling configurations more difficult.</p>
</li>
<li>
<p>Lower compaction thresholds result in fewer auto-scaling events, but higher rebalance times since there is more data per node.
Therefore, the memory quota threshold may need to be adjusted down for workloads with set rates higher than 30%.</p>
</li>
<li>
<p>Higher compaction thresholds will result in more auto-scaling events, which is less cost efficient but leads to faster rebalances since less data exists per node.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_example-configs">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The examples below are incomplete configurations that are meant to show the implementation of the recommended settings within the relevant resources.
For a more complete example of how to implement the recommended auto-scaling settings, refer to <a href="#tutorial-autoscale-data.adoc" class="page unresolved">tutorial-autoscale-data.adoc</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>CouchbaseCluster</code> Recommended Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  autoscaleStabilizationPeriod: 0s <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recommended Couchbase Stabilization Period</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>HorizontalPodAutoscaler</code> Recommended Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: HorizontalPodAutoscaler
apiVersion: autoscaling/v2beta2
metadata:
  name: data-hpa
spec:
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 30 <i class="conum" data-value="1"></i><b>(1)</b>
      policies:
      - type: Pods
        value: 1
        periodSeconds: 15
    scaleDown:
      stabilizationWindowSeconds: 300 <i class="conum" data-value="1"></i><b>(1)</b>
  metrics:
  - type: Pods
    pods:
      metric:
        name: cbbucketinfo_basic_quota_user_percent <i class="conum" data-value="2"></i><b>(2)</b>
      target:
        type: AverageValue
        averageValue: 70 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recommended HPA Stabilization Window</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Recommended Metric</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Recommended Threshold</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="query-service"><a class="anchor" href="#query-service"></a>Query Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="metric-cpu-utilization"><a class="anchor" href="#metric-cpu-utilization"></a>Metric: CPU Utilization</h3>
<div class="paragraph">
<p>Couchbase nodes that run the Query Service execute queries for your application needs.
When a query string is sent to Couchbase Server, the Query Service will inspect the string and parse it, planning which indexes to query.
Once this is done, it generates a query plan.
These steps require computation and processing that is heavily dependent on CPU resources.</p>
</div>
<div class="paragraph">
<p>Different queries have different performance requirements.
A simple query might return results within milliseconds and have very little impact on CPU, while a complex query may require several seconds and have much greater CPU overhead.
The Query Service balances query processing across Query Service nodes based on available resources.
However, if average CPU utilization across Query Service nodes gets too high, it is likely that the overall latency of queries will start to rise.</p>
</div>
<div class="sect3">
<h4 id="recommendations-2"><a class="anchor" href="#recommendations-2"></a>Recommendations</h4>
<div class="paragraph">
<p>The recommended metric for Query Service CPU utilization is <code>cpu</code>.
This metric is an internal Kubernetes metric provided by <a href="https://github.com/kubernetes-sigs/metrics-server" target="_blank" rel="noopener">Metrics Server</a>, and represents the total CPU utilization of all containers that belong to a pod divided by the sum of all of their requests.</p>
</div>
<div class="paragraph">
<p>The following considerations should be taken into account when scaling on this metric:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scaling on CPU utilization is most effective for queries which are CPU-bound.</p>
</li>
<li>
<p>The <code>cpu</code> metric represents overall pod CPU utilization, not just the Couchbase container.
Therefore, this metric also includes the CPU usage of other containers such as the <a href="howto-prometheus.html" class="page">Couchbase Exporter</a> and <a href="concept-couchbase-logging.html#log-forwarding" class="page">Logging</a> sidecars.</p>
<div class="ulist">
<ul>
<li>
<p>When scaling on CPU utilization, it is particularly important that you set consistent CPU resource requests and limits for each container in a Couchbase pod.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_recommended-settings"></a>Recommended Settings</p>
</li>
<li>
<p><a id="tabset3_example-configs"></a>Example Configs</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_recommended-settings">
<div class="paragraph">
<p>Based on internal benchmark testing, we believe the following settings provide a good starting point for scaling the Query Service based on <em>CPU utilization</em>:</p>
</div>
<table id="table-autoscale-query-recommendations-cpu-utilization" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Threshold</th>
<th class="tableblock halign-left valign-top">HPA Stabilization Window</th>
<th class="tableblock halign-left valign-top">Couchbase Stabilization Period</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>70%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>300s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>600s</code></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">General notes:</div>
<ul>
<li>
<p>Benchmark tests were based on a query workload with 0% write rate.</p>
</li>
<li>
<p>The Query Service should be scaled at 10-20% below peak CPU usage.
Our testing revealed 70% to be a good baseline.</p>
<div class="ulist">
<ul>
<li>
<p>The default threshold tolerance of the <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#algorithm-details">HPA scaling algorithm</a> is 0.1.
Auto-scaling the Query Service will not perform well if the workload results in CPU usage deviating ±10% at your workload&#8217;s “steady state”.
This is because auto-scaling will continually counterbalance itself over time.
Therefore you should be mindful of this window when choosing a CPU scaling threshold.
Note that the deviation becomes smaller as CPU threshold lowers, with the deviation being relatively ideal at the recommended 70% threshold.</p>
</li>
</ul>
</div>
</li>
<li>
<p>On average, an additional pod provided 5% CPU relief for workloads averaging 10 queries/sec at 500ms.
Peak CPU should be less than 95% to ensure scaling will immediately improve CPU usage.</p>
</li>
<li>
<p>A high 10m Couchbase stabilization period ensures additional nodes are fully acclimated to the workload.</p>
</li>
<li>
<p>5m HPA stabilization is recommended to prevent quick directional changes.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_example-configs">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The examples below are incomplete configurations that are meant to show the implementation of the recommended settings within the relevant resources.
For a more complete example of how to implement the recommended auto-scaling settings, refer to <a href="#tutorial-autoscale-query.adoc" class="page unresolved">tutorial-autoscale-query.adoc</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>CouchbaseCluster</code> Recommended Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  autoscaleStabilizationPeriod: 600s <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recommended Couchbase Stabilization Period</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>HorizontalPodAutoscaler</code> Recommended Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: HorizontalPodAutoscaler
apiVersion: autoscaling/v2beta2
metadata:
  name: query-hpa
spec:
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 30 <i class="conum" data-value="1"></i><b>(1)</b>
      policies:
      - type: Pods
        value: 1
        periodSeconds: 15
    scaleDown:
      stabilizationWindowSeconds: 300 <i class="conum" data-value="1"></i><b>(1)</b>
  metrics:
  - type: Resource
    resource:
      name: cpu <i class="conum" data-value="2"></i><b>(2)</b>
      target:
        type: Utilization
        averageUtilization: 70 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recommended HPA Stabilization Window</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Recommended Metric</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Recommended Threshold</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="index-service"><a class="anchor" href="#index-service"></a>Index Service</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="metric-memory-utilization"><a class="anchor" href="#metric-memory-utilization"></a>Metric: Memory Utilization</h3>
<div class="paragraph">
<p>The Index Service is used to create indexes from predefined subsets of bucket-data.
Most notably, <em>secondary indexes</em> are created by the Index Service to support queries made by the Query Service on attributes within documents.</p>
</div>
<div class="paragraph">
<p>Similar to buckets, secondary indexes use available memory to provide high-speed performance for certain operations.
However, unlike buckets, secondary indexes do not have individually-configurable memory quotas.
All indexes utilize the overall memory quota assigned to the Index Service.</p>
</div>
<div class="paragraph">
<p>The Index Service can be configured to use either <em>standard</em> or <em>memory-optimized</em> storage.
The index storage setting is global: it is established at cluster-initialization for all indexes on the cluster, across all buckets.
<em>Standard</em> is the default storage setting for secondary indexes: the indexes are saved on disk; in a disk-optimized format that uses both memory and disk for index-update and scanning.
<em>Memory-optimized</em> index-storage allows high-speed maintenance and scanning; since the index is kept fully in memory at all times.
A snapshot of the memory-optimized index is maintained on disk, to permit rapid recovery if node-failures are experienced.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The performance of standard index storage depends on overall I/O performance.
As memory becomes constrained, the Index Service relies more heavily on slower-performing disk.</p>
</li>
<li>
<p>Memory-optimized index storage requires that all nodes running the Index Service have a memory quota sufficient for the number and size of their resident indexes, and for the frequency with which the indexes will be updated and scanned.</p>
<div class="ulist">
<ul>
<li>
<p>If indexer memory usage goes above the high water mark of the Index Service memory quota, the indexer goes into the Paused mode on that node; and although the indexes remain in Active state, traffic is routed away from the node.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your goal it to maintain peak performance for all index storage types, then you must prevent the memory utilization of the Index Service from ever reaching the high water mark.
In practice this means that before the high water mark is reached, you must either increase the Index Service&#8217;s memory quota, or scale out the cluster with additional nodes running the Index Service (thus increasing the amount of memory reserved for indexes on all nodes).</p>
</div>
<div class="paragraph">
<p>The first solution&#8201;&#8212;&#8201;increasing the Index Service&#8217;s memory quota&#8201;&#8212;&#8201;requires manual intervention and may not be possible if there is no unreserved memory left on Index Service nodes.
This makes the second solution&#8201;&#8212;&#8201;scaling out the number of Index Service nodes&#8201;&#8212;&#8201;much more desirable, and an ideal use-case for cluster auto-scaling.</p>
</div>
<div class="sect3">
<h4 id="recommendations-3"><a class="anchor" href="#recommendations-3"></a>Recommendations</h4>
<div class="paragraph">
<p>The recommended metric for Index Service memory utilization is <code>cbindex_ram_percent</code>.
This metric is a Couchbase "custom metric" provided by the Couchbase Prometheus Exporter, and represents the amount of memory used by the Index Service as a percentage of the Index Service&#8217;s memory quota.</p>
</div>
<div class="paragraph">
<p>The following considerations should be taken into account when scaling on this metric:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Secondary indexes must utilize <a href="../../server/7.0/learn/services-and-indexes/indexes/index-replication.html#index-partitioning" class="page">partitioning</a> in order for the Index Service to be auto-scaled.
(Secondary indexes in Couchbase Server Enterprise Edition are created with partitions by default.)</p>
<div class="ulist">
<ul>
<li>
<p>When new Index nodes are added or removed from the cluster, the rebalance operation attempts to move the index partitions across available Index nodes in order to balance resource consumption.
The Index Service will only attempt to balance resource consumption on a best try basis.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_recommended-settings"></a>Recommended Settings</p>
</li>
<li>
<p><a id="tabset4_example-configs"></a>Example Configs</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_recommended-settings">
<div class="paragraph">
<p>Based on internal benchmark testing, we believe the following settings provide a good starting point for scaling the Index Service based on <em>memory utilization</em>:</p>
</div>
<table id="table-autoscale-index-recommendations-memory-utilization" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Threshold</th>
<th class="tableblock halign-left valign-top">HPA Stabilization Window</th>
<th class="tableblock halign-left valign-top">Couchbase Stabilization Period</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cbindex_ram_percent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0s</code></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">General notes:</div>
<ul>
<li>
<p>Benchmark tests were based on a 30% write rate of 16 byte document sizes.
Higher write rates or larger document sizes should use a threshold lower than 60% to account for longer rebalance times.</p>
</li>
<li>
<p>Index RAM distribution is uncertain and clusters may perform better when an even number of Index nodes are available.</p>
</li>
<li>
<p>Testing revealed that index RAM usage didn&#8217;t always drop immediately when a single Index node was added, but when a pair of nodes were added then RAM usage dropped.</p>
</li>
</ul>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset4_example-configs">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The examples below are incomplete configurations that are meant to show the implementation of the recommended settings within the relevant resources.
For a more complete example of how to implement the recommended auto-scaling settings, refer to <a href="#tutorial-autoscale-index.adoc" class="page unresolved">tutorial-autoscale-index.adoc</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>CouchbaseCluster</code> Recommended Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: couchbase.com/v2
kind: CouchbaseCluster
metadata:
  name: cb-example
spec:
  autoscaleStabilizationPeriod: 0s <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recommended Couchbase Stabilization Period</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>HorizontalPodAutoscaler</code> Recommended Settings</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: HorizontalPodAutoscaler
apiVersion: autoscaling/v2beta2
metadata:
  name: index-hpa
spec:
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 30 <i class="conum" data-value="1"></i><b>(1)</b>
      policies:
      - type: Pods
        value: 1
        periodSeconds: 15
    scaleDown:
      stabilizationWindowSeconds: 300 <i class="conum" data-value="1"></i><b>(1)</b>
  metrics:
  - type: Pods
    pods:
      metric:
        name: cbindex_ram_percent <i class="conum" data-value="2"></i><b>(2)</b>
      target:
        type: AverageValue
        averageValue: 50 <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Recommended HPA Stabilization Window</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Recommended Metric</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Recommended Threshold</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <div class="container">
    <div class="footer-links">
      <div class="col">
        <div class="footer-logo">
          <a href="https://www.couchbase.com" class="icon">
            <img src="../../_/img/couchbase_logo_black.svg" alt="Couchbase">
          </a>
        </div>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://docs.couchbase.com" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="https://forums.couchbase.com" target="_blank" rel="noopener">Forums</a></li>
          <li><a href="https://support.couchbase.com" target="_blank" rel="noopener">Support</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://developer.couchbase.com" target="_blank" rel="noopener">Developer Portal</a></li>
          <li><a href="https://blog.couchbase.com" target="_blank" rel="noopener">Blog</a></li>
          <li><a href="https://www.couchbase.com/resources">Resources</a></li>
        </ul>
      </div>
      <div class="col">
        <ul>
          <li><a href="https://www.couchbase.com/get-started-developing-nosql">Get Started</a></li>
          <li><a href="https://www.couchbase.com/downloads">Downloads</a></li>
          <li><a href="https://learn.couchbase.com/store?utf8=%E2%9C%93&ss=1&ct=78327&commit=Filter" target="_blank" rel="noopener">Training</a></li>
        </ul>
      </div>
      <div class="col">
        <ul class="social-icons">
          <li>
            <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="facebook" class="cls-1" d="M29,0H3A2.652,2.652,0,0,0,0,3V29a2.652,2.652,0,0,0,3,3H16V18H12V14h4V12a6.452,6.452,0,0,1,6-6h4v4H22a2.151,2.151,0,0,0-2,2v2h6l-1,4H20V32h9a2.652,2.652,0,0,0,3-3V3A2.652,2.652,0,0,0,29,0Z"/></svg>
            <a href="https://www.facebook.com/Couchbase" class="icon">
            Facebook
            </a>
          </li>
          <li>
            <svg  width="14" height="14" viewBox="0 0 32.1 26.1"> <path id="twitter" class="cls-1" d="M32,7.1a11.836,11.836,0,0,1-3.8,1,6.462,6.462,0,0,0,2.9-3.6,12.606,12.606,0,0,1-4.2,1.6A6.492,6.492,0,0,0,22.1,4a6.594,6.594,0,0,0-6.6,6.6,7.719,7.719,0,0,0,.2,1.5A18.458,18.458,0,0,1,2.2,5.2a6.294,6.294,0,0,0-.9,3.3A6.765,6.765,0,0,0,4.2,14a6.109,6.109,0,0,1-3-.8v.1a6.543,6.543,0,0,0,5.3,6.4,4.678,4.678,0,0,1-1.7.2,4.869,4.869,0,0,1-1.2-.1,6.679,6.679,0,0,0,6.1,4.6,12.917,12.917,0,0,1-8.2,2.8,9.151,9.151,0,0,1-1.6-.1,18.438,18.438,0,0,0,10.1,3c12.1,0,18.7-10,18.7-18.7v-.8A13.336,13.336,0,0,0,32,7.2Z" transform="translate(0.1 -4)"/></svg>
            <a href="https://twitter.com/couchbase" class="icon">
              Twitter
            </a>
          </li>
          <li>
          <svg  width="14" height="14" viewBox="0 0 32 32"> <path id="linkedin" class="cls-1" d="M29,0H3A3.076,3.076,0,0,0,0,3V29a3.009,3.009,0,0,0,3,3H29a2.946,2.946,0,0,0,3-3V3A3.009,3.009,0,0,0,29,0ZM12,26H8V12h4ZM10,10a2,2,0,1,1,2-2A2.006,2.006,0,0,1,10,10ZM26,26H22V18a2,2,0,0,0-4,0v8H14V12h4v2.5c.8-1.1,2.1-2.5,3.5-2.5A4.736,4.736,0,0,1,26,17Z"/></svg>
              <a href="https://www.linkedin.com/company/couchbase" class="icon">
             Linkedin
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="footer-terms">
      <div class="footer-terms-copyright">
          <span>© 2021 Couchbase, Inc. Couchbase, Couchbase Lite and the Couchbase logo are registered trademarks of Couchbase, Inc.</span>
      </div>
      <div class="footer-terms-links">
        <a href="https://www.couchbase.com/terms-of-use">Terms of Use</a>
        <a href="https://www.couchbase.com/privacy-policy">Privacy Policy</a>
        <a href="https://www.couchbase.com/cookie-policy">Cookie Policy</a>
        <a href="https://www.couchbase.com/support-policy">Support Policy</a>
        <a href="https://info.couchbase.com/unsubscribe-or-manage-preferences.html" target="_blank" rel="noopener">Marketing Preference Center</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/fontawesome-icon-defs.js"></script>
<script async src="../../_/js/vendor/fontawesome.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
</body>
</html>
